# ğŸ—ï¸ KIáº¾N TRÃšC Há»† THá»NG - MUSIC MANAGEMENT

## ğŸ“Š Tá»”NG QUAN KIáº¾N TRÃšC

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLIENT LAYER                          â”‚
â”‚  (Browser, Postman, Mobile App, External Systems)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ HTTP/HTTPS
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PRESENTATION LAYER                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Genre      â”‚  â”‚  MusicFile   â”‚  â”‚   Report     â”‚      â”‚
â”‚  â”‚  Controller  â”‚  â”‚  Controller  â”‚  â”‚  Controller  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                  â”‚                  â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ DTO
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BUSINESS LAYER                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Genre      â”‚  â”‚  MusicFile   â”‚  â”‚   File       â”‚      â”‚
â”‚  â”‚   Service    â”‚  â”‚   Service    â”‚  â”‚   Util       â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                  â”‚                  â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ Entity
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PERSISTENCE LAYER                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚   Genre      â”‚  â”‚  MusicFile   â”‚  Spring Data JPA        â”‚
â”‚  â”‚  Repository  â”‚  â”‚  Repository  â”‚  + Hibernate            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ JDBC
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATABASE LAYER                          â”‚
â”‚                    PostgreSQL 15+                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ music_genre  â”‚  â”‚  music_file  â”‚                         â”‚
â”‚  â”‚   (table)    â”‚  â”‚   (table)    â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FILE STORAGE                            â”‚
â”‚        /uploads/music  |  /uploads/thumbnails               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ LAYERED ARCHITECTURE

### 1. Presentation Layer (Controller)

**Nhiá»‡m vá»¥:**
- Nháº­n HTTP requests tá»« clients
- Validate request parameters
- Gá»i Service layer
- Tráº£ vá» HTTP responses
- Xá»­ lÃ½ exception

**Components:**
- `MusicGenreController` - APIs quáº£n lÃ½ thá»ƒ loáº¡i
- `MusicFileController` - APIs quáº£n lÃ½ file nháº¡c
- `ReportController` - APIs bÃ¡o cÃ¡o thá»‘ng kÃª
- `GlobalExceptionHandler` - Xá»­ lÃ½ exception toÃ n cá»¥c

**Endpoints:**
```
/api/genres/*
/api/music-files/*
/api/reports/*
```

---

### 2. Business Layer (Service)

**Nhiá»‡m vá»¥:**
- Business logic chÃ­nh
- Validate business rules
- Transaction management
- TÆ°Æ¡ng tÃ¡c vá»›i Repository layer
- Convert giá»¯a Entity vÃ  DTO

**Components:**
- `MusicGenreService` & `MusicGenreServiceImpl`
- `MusicFileService` & `MusicFileServiceImpl`
- `FileUtil` - Utility cho file operations

**Business Rules:**
- Validate mÃ£ thá»ƒ loáº¡i/file unique
- Kiá»ƒm tra file type vÃ  size
- TÃ­nh toÃ¡n Ä‘á»™ tuá»•i file nháº¡c
- Xá»­ lÃ½ metadata extraction

---

### 3. Persistence Layer (Repository)

**Nhiá»‡m vá»¥:**
- Truy váº¥n database
- CRUD operations
- Custom queries
- Data access abstraction

**Components:**
- `MusicGenreRepository` - Spring Data JPA Repository
- `MusicFileRepository` - Spring Data JPA Repository

**Features:**
- Auto-generated CRUD methods
- Custom query methods
- JPQL queries
- Pagination support

---

### 4. Database Layer

**Schema:**
```
music_genre (Thá»ƒ loáº¡i nháº¡c)
â”œâ”€â”€ id (PK)
â”œâ”€â”€ genre_code (UNIQUE)
â”œâ”€â”€ genre_name
â”œâ”€â”€ description
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

music_file (File nháº¡c)
â”œâ”€â”€ id (PK)
â”œâ”€â”€ file_code (UNIQUE)
â”œâ”€â”€ file_name
â”œâ”€â”€ file_path
â”œâ”€â”€ thumbnail_path
â”œâ”€â”€ file_type
â”œâ”€â”€ genre_id (FK â†’ music_genre.id)
â”œâ”€â”€ download_link
â”œâ”€â”€ description
â”œâ”€â”€ artist
â”œâ”€â”€ album
â”œâ”€â”€ duration
â”œâ”€â”€ file_size
â”œâ”€â”€ release_year
â”œâ”€â”€ created_at
â””â”€â”€ updated_at
```

**Indexes:**
- Primary keys (id)
- Unique constraints (genre_code, file_code)
- Foreign keys (genre_id)
- Search indexes (artist, release_year)

---

## ğŸ”„ DATA FLOW

### Táº¡o File Nháº¡c Má»›i (Create Music File)

```
1. Client
   â”‚ POST /api/music-files
   â”‚ Request Body: MusicFileDTO
   â–¼
2. MusicFileController
   â”‚ @PostMapping
   â”‚ Validate @Valid
   â–¼
3. MusicFileService
   â”‚ createMusicFile(dto)
   â”‚ - Check duplicate file_code
   â”‚ - Convert DTO â†’ Entity
   â”‚ - Validate genre exists
   â–¼
4. MusicFileRepository
   â”‚ save(entity)
   â–¼
5. PostgreSQL
   â”‚ INSERT INTO music_file
   â–¼
6. Return Flow
   â”‚ Entity â†’ DTO â†’ Response
   â”‚ HTTP 201 Created
   â–¼
7. Client receives MusicFileDTO
```

### Upload File Nháº¡c (Upload Music File)

```
1. Client
   â”‚ POST /api/music-files/upload
   â”‚ multipart/form-data
   â–¼
2. MusicFileController
   â”‚ @PostMapping("/upload")
   â”‚ MultipartFile + params
   â–¼
3. FileUtil
   â”‚ validateMusicFile()
   â”‚ - Check file type (mp3, wav, etc.)
   â”‚ - Check file size (max 100MB)
   â–¼
4. FileUtil
   â”‚ saveMusicFile()
   â”‚ - Generate unique filename
   â”‚ - Save to /uploads/music
   â–¼
5. FileUtil (Optional)
   â”‚ extractMetadata()
   â”‚ - Extract artist, album, duration
   â–¼
6. MusicFileService
   â”‚ createMusicFile(dto)
   â”‚ Save metadata to database
   â–¼
7. Return file path & metadata
```

### TÃ¬m kiáº¿m File Nháº¡c (Search)

```
1. Client
   â”‚ GET /api/music-files/search?keyword=xyz
   â–¼
2. MusicFileController
   â”‚ searchMusicFiles(keyword, pageable)
   â–¼
3. MusicFileService
   â”‚ searchMusicFiles(keyword, pageable)
   â–¼
4. MusicFileRepository
   â”‚ @Query: SELECT ... WHERE
   â”‚ fileName LIKE %keyword% OR
   â”‚ artist LIKE %keyword%
   â–¼
5. PostgreSQL
   â”‚ Full-text search on indexed columns
   â–¼
6. Return Page<MusicFile>
   â”‚ Convert to Page<MusicFileDTO>
   â–¼
7. Client receives paginated results
```

### BÃ¡o cÃ¡o File CÅ© >40 nÄƒm (Report)

```
1. Client
   â”‚ GET /api/reports/old-music?minAge=40
   â–¼
2. ReportController
   â”‚ getOldMusicFiles(40)
   â–¼
3. MusicFileService
   â”‚ getOldMusicFiles(40)
   â”‚ Calculate: currentYear - minAge
   â–¼
4. MusicFileRepository
   â”‚ findOldMusicFiles(maxReleaseYear)
   â”‚ WHERE release_year <= 1984
   â–¼
5. PostgreSQL
   â”‚ SELECT * FROM music_file
   â”‚ WHERE release_year <= 1984
   â–¼
6. Return List<MusicFile>
   â”‚ Convert to List<MusicFileDTO>
   â”‚ Calculate age for each file
   â–¼
7. Client receives list of old files
```

---

## ğŸ” SECURITY CONSIDERATIONS

### Current Implementation

- âœ… Input validation (Bean Validation)
- âœ… SQL Injection protection (JPA/Hibernate)
- âœ… File type validation
- âœ… File size limits
- âœ… Exception handling
- âœ… CORS configuration

### Recommended Additions (Future)

- ğŸ”œ Spring Security + JWT authentication
- ğŸ”œ Role-based access control (RBAC)
- ğŸ”œ API rate limiting
- ğŸ”œ Request encryption (HTTPS)
- ğŸ”œ File virus scanning
- ğŸ”œ Audit logging

---

## âš¡ PERFORMANCE OPTIMIZATIONS

### Implemented

- âœ… Database indexing
- âœ… Pagination for large datasets
- âœ… Lazy loading for relationships
- âœ… Connection pooling (HikariCP)
- âœ… Query optimization (JPQL)

### Recommended (Future)

- ğŸ”œ Redis caching (for genres, reports)
- ğŸ”œ CDN for file delivery
- ğŸ”œ Async file processing
- ğŸ”œ Database query caching
- ğŸ”œ Load balancing

---

## ğŸ“¦ DEPENDENCIES

### Core Framework
- Spring Boot 3.2.0
- Spring Web
- Spring Data JPA
- Hibernate

### Database
- PostgreSQL Driver
- Flyway (Migration)

### Utilities
- Lombok (Reduce boilerplate)
- Apache Commons IO
- Apache Tika (Metadata)
- JAudioTagger (Audio metadata)

### Documentation
- SpringDoc OpenAPI (Swagger)

### Testing
- Spring Boot Test
- JUnit 5
- Mockito
- H2 Database (for tests)

---

## ğŸŒ DEPLOYMENT ARCHITECTURE

### Option 1: Standalone

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Spring Boot App   â”‚ :3005
â”‚   (Embedded Tomcat) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    PostgreSQL DB    â”‚ :5432
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Option 2: Docker Compose

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Docker Container   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Spring Boot   â”‚  â”‚ :3005
â”‚  â”‚ Application   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚          â”‚          â”‚
â”‚          â–¼          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PostgreSQL   â”‚  â”‚ :5432
â”‚  â”‚   Database    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   Docker Network
```

### Option 3: Production (Cloud)

```
        Load Balancer
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                   â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”
â”‚ App 1 â”‚         â”‚ App 2  â”‚  Spring Boot
â””â”€â”€â”€â”¬â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜  Instances
    â”‚                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PostgreSQL RDS â”‚       Managed DB
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  File Storage  â”‚       S3/Azure Blob
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ DESIGN PATTERNS

### Applied Patterns

1. **Layered Architecture** - Separation of concerns
2. **Repository Pattern** - Data access abstraction
3. **DTO Pattern** - Data transfer objects
4. **Service Pattern** - Business logic encapsulation
5. **Dependency Injection** - Loose coupling
6. **Builder Pattern** - Lombok @Builder
7. **Factory Pattern** - Spring Bean creation
8. **Singleton Pattern** - Spring @Service, @Repository

### SOLID Principles

- âœ… **S**ingle Responsibility - Each class has one job
- âœ… **O**pen/Closed - Open for extension, closed for modification
- âœ… **L**iskov Substitution - Service interfaces
- âœ… **I**nterface Segregation - Focused interfaces
- âœ… **D**ependency Inversion - Depend on abstractions

---

## ğŸ“ˆ SCALABILITY

### Horizontal Scaling
- Stateless application design
- Shared database
- Shared file storage (S3/NFS)
- Load balancer distribution

### Vertical Scaling
- Increase JVM heap size
- Database connection pool tuning
- CPU/Memory upgrade

### Database Scaling
- Read replicas
- Partitioning by year/genre
- Sharding (if needed)

---

**Kiáº¿n trÃºc nÃ y Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ dá»… maintain, má»Ÿ rá»™ng vÃ  test!** ğŸš€

